require(["jquery","underscore","backbone"],function(e,t,n){var r=this.Tornado||{},i=this.Tornado=r;return i.Operator={equals:["==","eq","equals","equals_to"],unequals:["!=","ne","neq","does_not_equal","not_equal_to"],gt:[">","gt"],lt:["<","lt"],gte:[">=","ge","gte","geq"],lte:["<=","le","lte","leq"],element_of:["in","element_of"],not_element_of:["not_in","not_element_of"],is_null:["is_null"],is_not_null:["is_not_null"],like:["like"],has:["has"],any:["any"]},i.xsrf_token=null,i.Model=n.Model.extend({schema:{},defaults:{},urlRoot:null,idAttribute:null,idAttributes:null,relations:[],columnAttributes:[],relationAttributes:[],readonlyAttributes:[],is_numeric:function(e){if(this.schema.hasOwnProperty(e)){if(this.schema[e].type=="Number")return!0;if(this.schema[e].type=="Text"&&this.schema[e].dataType=="number")return!0}return!1},is_datetime:function(e){if(this.schema.hasOwnProperty(e)){if(this.schema[e].type=="DateTime")return!0;if(this.schema[e].type=="Text"&&this.schema[e].dataType=="datetime")return!0}return!1},getDatetimeAttributes:function(){if(this.hasOwnProperty("datetimeAttributes"))return this.datetimeAttributes;var e,t,n,r=[];for(e=0,t=this.columnAttributes.length;e<t;e++)n=this.columnAttributes[e],this.is_datetime(n)&&r.push(n);return this.datetimeAttributes=r,r},parse:function(e,t){var r=n.Model.prototype.parse.call(this,e,t),i,s,o;for(i=0,s=this.getDatetimeAttributes().length;i<s;i++)o=this.datetimeAttributes[i],r[o]=new Date(r[o]);return r},sync:function(e,t,r){return i.xsrf_token&&(r=r||{},r.headers=r.headers||{},r.headers["X-XSRFToken"]=i.xsrf_token),n.sync(e,t,r)},toString:function(){var e=this.get("__str__");return e?e:"[object Tornado.Model at "+this.url()+"]"}}),i.Collection=n.Collection.extend({page:0,page_length:null,num_results:null,hasMore:function(){return this.num_results<this.models.length},fetch:function(e){var r=this;return e=e?t.clone(e):{},e.data=e.data?e.data:{},this.page_length&&(e.data.results_per_page=this.page_length),e.data.page||(e.data.page=e.reset||!r.page?undefined:r.page+1),this.trigger("page:fetch"),n.Collection.prototype.fetch.call(r,e)},parse:function(e){var t=e&&e.objects;return t?(this.num_results=e.num_results||e.length,this.page=e.page||1,this.total_pages=e.total_pages||0,this.num_results<this.models.length+t.length&&this.trigger("page:showing",this.page),this.trigger("page:complete"),t):(this.trigger("page:complete"),this.num_results=0,this.page=0,this.total_pages=0,t)}}),i.FilteredCollection=i.Collection.extend({filters:[],filterBy:function(e,n){var r=this;t.isArray(e)?e.length>2?e={name:e[0],op:e[1],val:e[2]}:e={name:e[0],val:e[2]}:t.isString(e)&&(e={name:arguments[0],op:arguments[1],val:arguments[2]},n=arguments[3]),t.defaults(e,{op:"eq"}),n.update&&(r.filters=t.reject(r.filters,function(t){return t.name==e["name"]})),r.filters.push(e),n.nofetch||r.fetch({reset:!0})},sortBy:function(e,n){var r=this;t.isArray(e)?e.length>2?e={name:e[0],op:e[1]}:e={name:e[0]}:t.isString(e)&&(e={name:arguments[0],op:arguments[1]},n=arguments[2]),t.defaults(e,{op:"asc"}),n.update&&(r.filters=t.reject(r.filters,function(e){return e.op=="asc"||e.op=="desc"})),r.filters.push(e),n.nofetch||r.fetch({reset:!0})},removeFilter:function(e,n){var r=this;t.isString(e)?r.filters=t.reject(r.filters,function(t){return t.name==e}):r.filters=t.reject(r.filters,function(t){return t==e}),n.nofetch||r.fetch({reset:!0})},removeSort:function(e){var n=this;n.filters=t.reject(n.filters,function(e){return e.op=="asc"||e.op=="desc"}),e.nofetch||n.fetch({reset:!0})},fetch:function(e){var n=this;return e=e?t.clone(e):{},e.data=e.data?e.data:{},e.data.q=JSON.stringify({filters:n.filters}),i.Collection.prototype.fetch.call(n,e)}}),i}).call(window),require(["jquery","underscore","backbone"],function(e,t,n){var r=this.Tornado||{},i=this.Tornado=r;return i.BackboneCollection=n.View.extend({events:{"click .btn-page":"navigate"},initialize:function(){this.options.collection&&(t.isString(this.options.collection)?this.collection=this.options.collection=new window[this.options.collection]:this.collection=this.options.collection),this.options.template?this.template=t.template(e(this.options.template).text()):this.template=t.template(this.$el.html().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),this.$el.empty(),this.listenTo(this.collection,"add",this.addElement),this.listenTo(this.collection,"remove",this.removeElement),this.listenTo(this.collection,"hide",this.hideElement),this.listenTo(this.collection,"show",this.showElement),this.listenTo(this.collection,"sync",this.renderFooter),this.listenTo(this.collection,"reset",this.render),this.$el.addClass("tb-collection")},navigate:function(t){var n=e(t.currentTarget),r=this,i=parseInt(n.text());n.closest("footer").find(".btn-page-active").removeClass("btn-page-active"),n.addClass("btn-page-active").addClass("btn-page-loading");if(!isNaN(i))this.collection.fetch({data:{page:i}});else if(n.is(".btn-step-forward"))this.collection.fetch({data:{page:this.collection.page+1}});else if(n.is(".btn-step-backward"))this.collection.fetch({data:{page:this.collection.page-1}});else if(n.is(".btn-fast-forward"))this.collection.fetch({data:{page:this.collection.total_pages}});else{if(!n.is(".btn-fast-backward"))throw"Unexpected navigation target";this.collection.fetch({data:{page:0}})}},render:function(e){var n=this.$el,r=this,i=this.collection;return e=t.extend(this.options,e||{}),i.length>0||e.reset?(r.renderElements(e),r.renderFooter(e)):i.fetch({success:function(){r.renderElements(e),r.renderFooter(e)}}),r.setElement(n),n.addClass(r.className),r},renderElements:function(e){var t=this,n=this.collection;n.each(function(e){t.addElement(e)})},addElement:function(t){var n=this,r=n.$el.find("> [name='"+t.id+"']");r.length==0&&(r=e("<div></div>"),r.attr("name",t.id),n.$el.append(r)),r.html(n.template(t.attributes))},showElement:function(e){var t=this,n=t.$el.find("> [name='"+e.id+"']");n.show()},hideElement:function(e){var t=this,n=t.$el.find("> [name='"+e.id+"']");n.hide()},removeElement:function(e){var t=this,n=t.$el.find("> [name='"+e.id+"']");n.remove()},renderFooter:function(t){var n=this,r=this.collection,i={page:r.page||1,page_length:r.page_length,total_pages:r.total_pages||0},s=e(n.constructor.footerTemplate(i));i.page<2?(s.find(".btn-fast-backward").addClass("disabled"),s.find(".btn-step-backward").addClass("disabled")):i.page<3&&s.find(".btn-fast-backward").addClass("disabled"),i.page>=i.total_pages?(s.find(".btn-fast-forward").addClass("disabled"),s.find(".btn-step-forward").addClass("disabled")):i.page>i.total_pages&&s.find(".btn-fast-forward").addClass("disabled"),n.$el.find("footer").remove(),n.$el.append(s)}},{footerTemplate:t.template('            <footer class="pagination">              <a class="btn btn-page btn-fast-backward"><i class="glyphicon glyphicon-fast-backward"></i></a>              <a class="btn btn-page btn-step-backward"><i class="glyphicon glyphicon-step-backward"></i></a>              <% if (page > 1) { %><a class="btn btn-page btn-page-number">1</a><% } %>              <% if (page >= 6) { %><span class="btn btn-page btn-page-ellipses">...</span><% } %>              <% if (page == 5) { %><a class="btn btn-page btn-page-number">2</a><% } %>              <% if (page > 3) { %><a class="btn btn-page btn-page-number"><%= (page-2) %></a><% } %>              <% if (page > 2) { %><a class="btn btn-page btn-page-number"><%= (page-1) %></a><% } %>              <a class="btn btn-page btn-page-number btn-page-active"><%= page %></a>              <% if (page < total_pages-1) { %><a class="btn btn-page btn-page-number"><%= (page+1) %></a><% } %>              <% if (page < total_pages-2) { %><a class="btn btn-page btn-page-number"><%= (page+2) %></a><% } %>              <% if (page == total_pages-3) { %><a class="btn btn-page btn-page-number"><%= (total_pages-1) %></a><% } %>              <% if (page <= total_pages-4) { %><span class="btn btn-page btn-page-ellipses">...</span><% } %>              <% if (page < total_pages) { %><a class="btn btn-page btn-page-number"><%= (total_pages) %></a><% } %>              <a class="btn btn-page btn-step-forward"><i class="glyphicon glyphicon-step-forward"></i></a>              <a class="btn btn-page btn-fast-forward"><i class="glyphicon glyphicon-fast-forward"></i></a>            </footer>        ')}),e.fn.tbcollection=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=e(this),s=r.data("tb.collection"),o=typeof t=="object"&&t;s||(o.el=r,r.data("tb.collection",s=new i.BackboneCollection(o)),o.delay?r.data("tb.collection").trigger("page:delay"):r.data("tb.collection").render()),typeof t=="string"&&s[t].apply(s,n)})},e.fn.tbcollection.Constructor=i.BackboneCollection,e("[data-collection][data-require]").each(function(){var t=e(this);require(e(this).data("require").split(" "),function(){t.tbcollection(t.data())})}),e("[data-collection]:not([data-require])").each(function(){var t=e(this);t.tbcollection(t.data())}),i}).call(window),require(["jquery","underscore","backbone","backbone-forms"],function(e,t,n){var r=this.Tornado||{},i=this.Tornado=r;return i.BackboneForm=n.View.extend({initialize:function(){this.options.model&&(t.isString(this.options.model)?this.model=this.options.model=new window[this.options.model]:this.model=this.options.model,t.isObject(this.options.value)&&this.model.set(this.options.value)),this.form=new n.Form(this.options),this.listenTo(this.form,"all",this.handleFormEvent)},handleFormEvent:function(e,t,n){this.trigger(e,n||t||this);var r=e.split(":");r.length>1&&(this.trigger("tb:"+r[1],t,n),this.trigger("tb:"+r[1]+":"+r[0],t,n))},render:function(){var n=this.form,r=this.$el,i=this.form.fields;return r.find("[data-editors]").add(r).each(function(r,s){var o=e(s),u=o.data("editors");if(t.isUndefined(u))return;var a=u=="*"?n.selectedFields||t.keys(i):u.split(",");t.each(a,function(t){var n=i[t],r,s=n.editor.render().el;e.webshims?r=o.appendPolyfill(s):r=o.append(s)}),o.removeAttr("data-editors")}),r.find("[data-fields]").add(r).each(function(s,o){var u=e(o),a=u.data("fields");if(t.isUndefined(a))return;var f=a=="*"?n.selectedFields||t.keys(i):a.split(",");t.each(f,function(n){var s=i[n];if(!s){console.error("Could not find "+n+" in fields for "+r);return}s.schema=s.schema||{},s.schema=t.extend(s.schema,u.data("schema"));var o,a=s.render().el;e.webshims?o=u.appendPolyfill(a):o=u.append(a),s.schema.editorAttrs=s.schema.editorAttrs||{},s.schema.editorAttrs=t.extend(s.schema.editorAttrs,u.data("editorAttrs")),s.editor.$el.attr(s.schema.editorAttrs),s.editor.$el.addClass(u.data("editorClass"))}),u.removeAttr("data-fields")}),r.find("[data-fieldsets]").add(r).each(function(r,i){var s=e(i),o=s.data("fieldsets");if(t.isUndefined(o))return;t.each(n.fieldsets,function(n){var r,i=n.render().el;e.webshims?r=s.appendPolyfill(i):r=s.append(i),n.schema.editorAttrs=n.schema.editorAttrs||{},n.schema.editorAttrs=t.extend(n.schema.editorAttrs,s.data("editorAttrs")),n.editor.$el.find("[data-editor] input").attr(n.schema.editorAttrs),n.editor.$el.addClass(s.data("editorClass"))}),s.removeAttr("data-fieldsets")}),n.setElement(r),r.addClass(n.className),n}}),e.fn.tbform=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=e(this),s=r.data("tb.form"),o=typeof t=="object"&&t;s||(o.el=this,r.data("tb.form",s=new i.BackboneForm(o)),r.data("tb.form").render()),typeof t=="string"&&s[t].apply(s,n)})},e.fn.tbform.Constructor=i.BackboneForm,e("[data-model][data-require]").each(function(){var t=e(this);require(e(this).data("require").split(" "),function(){t.tbform(t.data())})}),e("[data-model]:not([data-require])").each(function(){var t=e(this);t.tbform(t.data())}),i}).call(window)